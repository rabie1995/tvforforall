"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8094:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>x,requestAsyncStorage:()=>v,routeModule:()=>g,serverHooks:()=>k,staticGenerationAsyncStorage:()=>w});var a={};r.r(a),r.d(a,{POST:()=>y,dynamic:()=>d,revalidate:()=>m,runtime:()=>p});var i=r(9303),n=r(8716),s=r(670),o=r(7070),u=r(3493),l=r(1818);let c=[{id:"plan_12m",name:"12 Months",durationMonths:12,priceUsd:59,popular:!0,perks:["4K & HD channels","Anti-freeze streams","24/7 support","Up to 2 devices"]},{id:"plan_6m",name:"6 Months",durationMonths:6,priceUsd:39,perks:["Full VOD library","Sports & PPV included","24/7 support"]},{id:"plan_3m",name:"3 Months",durationMonths:3,priceUsd:29,perks:["Instant activation","USDT payments","24/7 support"]}],d="force-dynamic",p="nodejs",m=0,h={plan_3m:"https://nowpayments.io/payment/?iid=6334134208&source=button",plan_6m:"https://nowpayments.io/payment/?iid=6035616621&source=button",plan_12m:"https://nowpayments.io/payment/?iid=5981936582&source=button"},f={"3m":"plan_3m","6m":"plan_6m","1y":"plan_12m"};async function y(e){try{let{fullName:t,email:r,region:a,adultChannels:i,plan:n}=await e.json(),s=f[n]||n;if(!t?.trim())return o.NextResponse.json({error:"Full name is required"},{status:400});if(!r?.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/))return o.NextResponse.json({error:"Valid email is required"},{status:400});if(!a?.trim())return o.NextResponse.json({error:"Region is required"},{status:400});let d=c.find(e=>e.id===s);if(!h[s]||!d)return o.NextResponse.json({error:"Invalid plan selected"},{status:400});await u._.product.upsert({where:{id:s},update:{name:d.name,priceUsd:d.priceUsd,durationDays:30*d.durationMonths,active:!0},create:{id:s,name:d.name,description:d.perks.join(", "),priceUsd:d.priceUsd,durationDays:30*d.durationMonths,active:!0}});let p=await (0,l.at)({fullName:t,email:r,region:a,source:"checkout"});if(!p.success)return o.NextResponse.json({error:p.error||"Could not save your details. Please try again."},{status:400});let m=await u._.order.create({data:{fullName:t,email:r,region:a,adultChannels:i,productId:s,paymentStatus:"pending",deliveryStatus:"pending"}});return o.NextResponse.json({orderId:m.id,paymentLink:h[s]},{status:200})}catch(e){return console.error("Checkout error:",e),o.NextResponse.json({error:"Checkout failed. Please retry in a moment."},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/checkout/route",pathname:"/api/checkout",filename:"route",bundlePath:"app/api/checkout/route"},resolvedPagePath:"C:\\Users\\ULTRAPC\\tvforall\\app\\api\\checkout\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:v,staticGenerationAsyncStorage:w,serverHooks:k}=g,_="/api/checkout/route";function x(){return(0,s.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:w})}},1818:(e,t,r)=>{r.d(t,{at:()=>i,dl:()=>n});var a=r(3493);async function i(e){try{let t=function(e){let t=[];return(!e.fullName||e.fullName.trim().length<2)&&t.push("Full name must be at least 2 characters"),e.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||t.push("Valid email address is required"),(!e.region||e.region.trim().length<2)&&t.push("Region is required"),{valid:0===t.length,errors:t}}(e);if(!t.valid)return{success:!1,error:t.errors.join(", ")};let r={fullName:e.fullName.trim(),email:e.email.trim().toLowerCase(),region:e.region.trim(),source:e.source?.trim()||"website"};if(await a._.clientData.findUnique({where:{email:r.email}})){let e=await a._.clientData.update({where:{email:r.email},data:{fullName:r.fullName,region:r.region,source:r.source}});return{success:!0,clientId:e.id}}let i=await a._.clientData.create({data:r});return{success:!0,clientId:i.id}}catch(e){return console.error("Error collecting client data:",e),{success:!1,error:"Failed to save client data"}}}async function n(e){let t=e.page||1,r=e.limit||50,i=e.search?{OR:[{email:{contains:e.search,mode:"insensitive"}},{region:{contains:e.search,mode:"insensitive"}},{fullName:{contains:e.search,mode:"insensitive"}}]}:{},[n,s]=await Promise.all([a._.clientData.findMany({where:i,orderBy:{createdAt:"desc"},skip:(t-1)*r,take:r}),a._.clientData.count({where:i})]);return{clients:n,total:s,page:t,pages:Math.ceil(s/r)}}},3493:(e,t,r)=>{r.d(t,{_:()=>i});let a=require("@prisma/client"),i=globalThis.prisma||new a.PrismaClient({log:["error","warn"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,972],()=>r(8094));module.exports=a})();