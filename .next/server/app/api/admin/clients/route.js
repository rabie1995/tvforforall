"use strict";(()=>{var e={};e.id=708,e.ids=[708],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},4508:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>d,dynamic:()=>u});var n=r(9303),i=r(8716),s=r(670),o=r(7070),l=r(9178),c=r(1818);let u="force-dynamic";async function d(e){try{let t=e.cookies.get("admin_token")?.value;if(!await (0,l.Wg)(t||""))return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),a=parseInt(r.get("page")||"1"),n=parseInt(r.get("limit")||"50"),i=r.get("search")||"",s=await (0,c.dl)({page:a,limit:n,search:i});return o.NextResponse.json(s,{status:200})}catch(e){return console.error("Clients fetch error:",e),o.NextResponse.json({error:"Failed to fetch clients"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/clients/route",pathname:"/api/admin/clients",filename:"route",bundlePath:"app/api/admin/clients/route"},resolvedPagePath:"C:\\Users\\ULTRAPC\\tvforall\\app\\api\\admin\\clients\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:h}=m,f="/api/admin/clients/route";function v(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},9178:(e,t,r)=>{r.d(t,{Wg:()=>c,v9:()=>o});var a=r(6890),n=r(1463),i=r(8691);let s=new TextEncoder().encode(process.env.ADMIN_SECRET||"dev_secret_key_change_in_production_minimum_32_chars");async function o(e,t){try{let r=process.env.ADMIN_USERNAME,a=process.env.ADMIN_PASSWORD_HASH;if(!r||!a)return console.error("[SECURITY] Admin credentials not configured in environment"),null;if(e!==r)return console.warn("[SECURITY] Failed login attempt (username mismatch)"),null;if(!await i.ZP.compare(t,a))return console.warn("[SECURITY] Failed login attempt (password mismatch)"),null;return await l(e)}catch(e){return console.error("[SECURITY] Error during authentication:",e),null}}async function l(e){return await new a.N({username:e,role:"admin"}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("24h").sign(s)}async function c(e){try{return(await (0,n._)(e,s)).payload}catch(e){return null}}},1818:(e,t,r)=>{r.d(t,{at:()=>n,dl:()=>i});var a=r(3493);async function n(e){try{let t=function(e){let t=[];return(!e.fullName||e.fullName.trim().length<2)&&t.push("Full name must be at least 2 characters"),e.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||t.push("Valid email address is required"),(!e.region||e.region.trim().length<2)&&t.push("Region is required"),{valid:0===t.length,errors:t}}(e);if(!t.valid)return{success:!1,error:t.errors.join(", ")};let r={fullName:e.fullName.trim(),email:e.email.trim().toLowerCase(),region:e.region.trim(),source:e.source?.trim()||"website"};if(await a._.clientData.findUnique({where:{email:r.email}})){let e=await a._.clientData.update({where:{email:r.email},data:{fullName:r.fullName,region:r.region,source:r.source}});return{success:!0,clientId:e.id}}let n=await a._.clientData.create({data:r});return{success:!0,clientId:n.id}}catch(e){return console.error("Error collecting client data:",e),{success:!1,error:"Failed to save client data"}}}async function i(e){let t=e.page||1,r=e.limit||50,n=e.search?{OR:[{email:{contains:e.search,mode:"insensitive"}},{region:{contains:e.search,mode:"insensitive"}},{fullName:{contains:e.search,mode:"insensitive"}}]}:{},[i,s]=await Promise.all([a._.clientData.findMany({where:n,orderBy:{createdAt:"desc"},skip:(t-1)*r,take:r}),a._.clientData.count({where:n})]);return{clients:i,total:s,page:t,pages:Math.ceil(s/r)}}},3493:(e,t,r)=>{r.d(t,{_:()=>n});let a=require("@prisma/client"),n=globalThis.prisma||new a.PrismaClient({log:["error","warn"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,972,905],()=>r(4508));module.exports=a})();