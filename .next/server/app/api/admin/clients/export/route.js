"use strict";(()=>{var e={};e.id=118,e.ids=[118],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},3136:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{GET:()=>p,dynamic:()=>u});var a=r(9303),i=r(8716),o=r(670),s=r(7070),c=r(9178),l=r(3493);let u="force-dynamic";async function p(e){try{let t=e.cookies.get("admin_token")?.value;if(!await (0,c.Wg)(t||""))return s.NextResponse.json({error:"Unauthorized"},{status:401});let r=await l._.clientData.findMany({orderBy:{createdAt:"desc"}}),n=function(e){if(0===e.length)return"";let t=e.map(e=>[e.id,e.fullName,e.email,e.region,e.source||"website",new Date(e.createdAt).toLocaleString()]);return["ID,Full Name,Email,Region,Source,Date",...t.map(e=>e.map(e=>{let t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t}).join(","))].join("\n")}(r),a=new Date().toISOString().split("T")[0].replace(/-/g,"_"),i=`clients_${a}.csv`;return new s.NextResponse(n,{status:200,headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="${i}"`}})}catch(e){return console.error("Export error:",e),s.NextResponse.json({error:"Failed to export data"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/clients/export/route",pathname:"/api/admin/clients/export",filename:"route",bundlePath:"app/api/admin/clients/export/route"},resolvedPagePath:"C:\\Users\\ULTRAPC\\tvforall\\app\\api\\admin\\clients\\export\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:x}=d,h="/api/admin/clients/export/route";function f(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}},9178:(e,t,r)=>{r.d(t,{Wg:()=>l,v9:()=>s});var n=r(6890),a=r(1463),i=r(8691);let o=new TextEncoder().encode(process.env.ADMIN_SECRET||"dev_secret_key_change_in_production_minimum_32_chars");async function s(e,t){try{let r=process.env.ADMIN_USERNAME,n=process.env.ADMIN_PASSWORD_HASH;if(!r||!n)return console.error("[SECURITY] Admin credentials not configured in environment"),null;if(e!==r)return console.warn("[SECURITY] Failed login attempt (username mismatch)"),null;if(!await i.ZP.compare(t,n))return console.warn("[SECURITY] Failed login attempt (password mismatch)"),null;return await c(e)}catch(e){return console.error("[SECURITY] Error during authentication:",e),null}}async function c(e){return await new n.N({username:e,role:"admin"}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("24h").sign(o)}async function l(e){try{return(await (0,a._)(e,o)).payload}catch(e){return null}}},3493:(e,t,r)=>{r.d(t,{_:()=>a});let n=require("@prisma/client"),a=globalThis.prisma||new n.PrismaClient({log:["error","warn"]})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972,905],()=>r(3136));module.exports=n})();