generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String         @id @default(cuid())
  email          String         @unique
  role           String         @default("USER")
  orders         Order[]
  subscriptions  Subscription[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model Product {
  id             String         @id
  name           String
  description    String?
  priceUsd       Float
  durationDays   Int
  active         Boolean        @default(true)
  orders         Order[]
  subscriptions  Subscription[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model Order {
  id             String         @id @default(cuid())
  product        Product        @relation(fields: [productId], references: [id])
  productId      String
  user           User?          @relation(fields: [userId], references: [id])
  userId         String?
  fullName       String
  email          String
  region         String
  adultChannels  Boolean        @default(false)
  paymentStatus  String         @default("pending")
  deliveryStatus String         @default("pending")
  nowpaymentsId  String?        @unique
  subscription   Subscription?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@index([email])
  @@index([paymentStatus])
  @@index([deliveryStatus])
}

model Subscription {
  id             String             @id @default(cuid())
  order          Order?             @relation(fields: [orderId], references: [id])
  orderId        String?            @unique
  product        Product            @relation(fields: [productId], references: [id])
  productId      String
  user           User?              @relation(fields: [userId], references: [id])
  userId         String?
  status         String             @default("PENDING")
  startAt        DateTime?
  endAt          DateTime?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
}

model ClientData {
  id             String         @id @default(cuid())
  fullName       String
  email          String         @unique
  region         String
  source         String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@index([email])
  @@index([region])
  @@index([createdAt])
}

model Conversation {
  id             String         @id @default(cuid())
  email          String
  status         String         @default("open")
  messages       Message[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@index([email])
  @@index([status])
  @@index([createdAt])
}

model Message {
  id             String         @id @default(cuid())
  conversation   Conversation   @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  conversationId String
  sender         String         @default("user")
  content        String
  createdAt      DateTime       @default(now())

  @@index([conversationId])
  @@index([sender])
  @@index([createdAt])
}
